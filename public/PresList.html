<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EDIT MODE</title>
    <link href="./CSS/PresListCSS.css" rel="stylesheet">
</head>

<body>
    <p id="loggedInnId" class="loggedInnClass">Logged in as: USERNAME</p>
    <h1>Presentations:</h1>
    <div class="buttonDivClassDiv">
    <div id="buttonDiv" class="buttonDivClass">
        <button id="createNewPres">Create New Presentation</button>
        <button id="deletePres">Delete Presentations</button>
    </div>
    <div id="signOutButtonDiv" class="signOutButtonDivClass">
            <button id="signOut">Sign out</button>
    </div>
    </div>
    <div id="presList" class="presListDiv">
        <div style="width:auto; height: auto; background-color: gray; margin: 10px;"></div>
        <div>
                <h2>Pres title</h2>
                <p>info om presentasjon</p>
        </div>
        
    </div>
</body>

<script>
    let welcome = document.getElementById("loggedInnId");
    let logout = document.getElementById('signOut');
    let newpres = document.getElementById('createNewPres');

    window.onload = init();

    async function init(){
        let username = localStorage.getItem("loggedin");
        let token = localStorage.getItem(`logintoken`);

        if(username && token) {
            welcome.innerHTML = `Logged in as ${username}`;
            loadPresentations(token);

            logout.addEventListener('click', endSession);
            newpres.addEventListener('click', startPres);
        }
        else {
            window.location.href = `index.html`;
        }
    }

    async function loadPresentations(token) {
        let userid = localStorage.getItem(`loggedID`);
        let url = `http://localhost:3000/presentations`;

        let updata = {
            userid: userid
        };
        let cfg = {
            method: "GET",
            headers: {"Content-Type":"application/json",
                "authorization": `${token}`,
                "userid" : `${userid}`},
        };
        let resp = await fetch(url, cfg);
        if(resp.ok){
            let presentations = await resp.json();
            console.log("Fetched it all!");
        }
    }


    async function endSession() {
        localStorage.clear();
        window.location.href = `index.html`;
    }

    function startPres() {
        window.location.href = `editMode.html`;
    }
    //code to get the presentations and push them in the DIV with a clickable button
</script>
</html>